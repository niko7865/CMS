<?php

//Function to start connection to the database.
function connect() {
	$conn = mysql_connect('niko.db','niko7865','QwPoASlk2$');
	if (!$conn) die('Error connecting to server!');
		mysql_select_db('christmas', $conn) or die('Error selecting database');
	return $conn;
}

//Function to close all connections to the database
function closeconnection($conn) {
	mysql_close($conn);
}

function displayArticles($type,$name) {
	$conn = connect(); //start connection

	if($name){
		$sql = "SELECT * FROM articles WHERE articlePersonID='$name' ORDER BY addDate DESC";
		$result = mysql_query($sql);
		if($result) {
			while($row=mysql_fetch_array($result)) {
				$title = htmlspecialchars($row[imageTitle]);
				$bytes = $row[articleImage];
				echo '<div class="article">
					<h2 class="alignleft"><a href="'.$row['url'].'" target="_blank">'.$row["articleTitle"].'</a></h2>
					<h2 class="alignright"><a href="?prs='.$row['articlePersonID'].'">'.$row["articlePerson"].'</a></h2>
					<div style="clear: both;"></div>
					<div class="line"></div>
					<div class="articleBody clear">
						<div class="figure"><img src="getimg.php?img='.$row['id'].'" height="230" alt="'.$row["articleTitle"].'" /></div>
						<p>'.$row['articleContent'].'</p>
						</div>
					<h4 class="alignleft">Added: '.$row['addDate'].'</h4>';
					canModify($row['id'],"index.php?prs=".$name);
			}
		}
	}
	elseif($type == 'rcv'){
		$sql = "SELECT * FROM articles WHERE category='$type' ORDER BY addDate DESC";
		$result = mysql_query($sql);
		if($result) {
			while($row=mysql_fetch_array($result)) {
				$title = htmlspecialchars($row[imageTitle]);
				$bytes = $row[articleImage];
				echo '<div class="article">
					<h2 class="alignleft"><a href="'.$row['url'].'" target="_blank">'.$row["articleTitle"].'</a></h2>
					<h2 class="alignright"><a href="?prs='.$row['articlePersonID'].'">'.$row["articlePerson"].'</a></h2>
					<div style="clear: both;"></div>
					<div class="line"></div>
					<div class="articleBody clear">
						<div class="figure"><img src="getimg.php?img='.$row['id'].'" height="230" alt="'.$row["articleTitle"].'" /></div>
						<p>'.$row['articleContent'].'</p>
						</div>
					<h4 class="alignleft">Added: '.$row['addDate'].'</h4>';
					canModify($row['id'],"index.php?cat=rcv");
			}
		}
	}
	else{
		for( $des = 10; $des >= 0; $des -= 1){	
			$sql = "SELECT * FROM articles WHERE category='$type' AND desire='$des' ORDER BY articlePrice ASC";
			$result = mysql_query($sql);
			if($result) {
				while($row=mysql_fetch_array($result)) {
					$title = htmlspecialchars($row[imageTitle]);
					$bytes = $row[articleImage];
					echo '<a href="'.$row['url'].'" target="_blank">
					<div class="article" id="article'.$row['id'].'">
						<h2 class="alignleft">'.$row["articleTitle"].'</h2>
						<h2 class="alignright">';
						if($type == 'red'){
							echo $row["articlePrice"].' Pages';
						}
						elseif($row["articlePrice"] == 0){
							echo 'FREE';
						}
						else{
							echo '$'.$row["articlePrice"].'';
						}
						echo '</h2>
						<div style="clear: both;"></div>
						<div class="line"></div>
						<div class="articleBody clear">
							<div class="figure"><img src="getimg.php?img='.$row['id'].'" height="230" alt="'.$row["articleTitle"].'" /></div>
							<p>'.$row['articleContent'].'</p>
							</div>
							<h4 class="alignleft">Added: '.$row['addDate'].'</h4>';
						canModify($row['id'],"index.php?cat=".$type);	
				}
			}
		}
	}
	closeconnection($conn);
}
function displayCategories() {
	$conn = connect(); //start connection
	
	$sql = "SELECT * FROM articles WHERE category='cat' ORDER BY id ASC";
	$result = mysql_query($sql);

	if($result) {
		while($row=mysql_fetch_array($result)) {
        		$title = htmlspecialchars($row[imageTitle]);
			$bytes = $row[articleImage];
			echo '<a href="'.$row['url'].'">
			<div class="article" id="article'.$row['id'].'">
			<h2 class="alignleft">'.$row["articleTitle"].'</h2>
			<div style="clear: both;"></div><div class="line"></div><div class="articleBody clear"><div class="figure">
			<img src="getimg.php?img='.$row['id'].'" height="230" alt="'.$row["articleTitle"].'" /></div>
			<p>'.$row['articleContent'].'</p>
			</div>';
			canModify($row['id'],"index.php");	
		}
	}
	closeconnection($conn);
}
function displayNav() {
	$conn = connect(); //start connection
	
	$sql = "SELECT * FROM articles WHERE category='cat' ORDER BY id ASC";
	$result = mysql_query($sql);

	if($result) {
		while($row=mysql_fetch_array($result)) {
			echo '<li><a href="'.$row[url].'">'.$row[articleTitle].'</a></li>';	
		}
	}
	closeconnection($conn);
}
function canModify($id,$url) {
	if ($_COOKIE["user"] == 'niko') {
		echo '</a><br /><h4 class="alignleft">
		<form enctype="multipart/form-data" action="editarticle.php?" method="post">
			<input type="hidden" name="id" value="'.$id.'">
			<input type="hidden" name="action" value="edit">
			<input type="hidden" name="url" value="'.$url.'">
			<input type="submit" value="Edit"/>
		</form></h4>
		<h4 class="alignright">
		<form enctype="multipart/form-data" action="editarticle.php?" method="post">
			<input type="hidden" name="id" value="'.$id.'">
			<input type="hidden" name="action" value="delete">
			<input type="hidden" name="url" value="'.$url.'">
			<input type="submit" value="Delete"/>
		</form></h4></div>';
	} else { echo '</div></a>'; }
}
function articleEdit() {
	echo 'Edited Article';
}
function articleDelete($id) {
	$conn = connect();
	$sql = "DELETE FROM articles WHERE id='$id'";
	if(mysql_query($sql)) {
		echo "<script type='text/javascript'> alert('Article Deleted'); </script>";
	}
	closeconnection($conn);
}
function siteLogin($url) {
	
}
?>
